<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>360° Multi-Node Virtual Tour with Hotspots</title>
  <link rel="stylesheet" href="https://unpkg.com/photo-sphere-viewer@4/dist/photo-sphere-viewer.css" />
  <style>
    html, body { margin: 0; height: 100%; overflow: hidden; }
    #viewer { width: 100%; height: 100vh; }
    #thumbnails {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 10;
    }
    .thumb {
      width: 80px;
      height: 45px;
      object-fit: cover;
      border: 2px solid white;
      cursor: pointer;
      border-radius: 6px;
    }
    .nav-button {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      font-size: 2rem;
      background: rgba(255, 255, 255, 0.6);
      border: none;
      border-radius: 50%;
      padding: 0.5rem 1rem;
      cursor: pointer;
      z-index: 10;
    }
    .prev { left: 10px; }
    .next { right: 10px; }
  </style>
</head>
<body>
  <div id="viewer"></div>
  <button class="nav-button prev" onclick="goToPrev()">⬅️</button>
  <button class="nav-button next" onclick="goToNext()">➡️</button>
  <div id="thumbnails"></div>

  <script src="https://unpkg.com/three@0.140.0/build/three.min.js"></script>
  <script src="https://unpkg.com/photo-sphere-viewer@4/dist/photo-sphere-viewer.min.js"></script>
  <script>
    const scenes = [
      {
        name: "Scene 1",
        src: "scene1.jpg",
        thumb: "thumb1.jpg",
        hotspots: [
          { yaw: 0, pitch: 0, target: 1 }
        ]
      },
      {
        name: "Scene 2",
        src: "scene2.jpg",
        thumb: "thumb2.jpg",
        hotspots: [
          { yaw: 1.5, pitch: 0, target: 2 },
          { yaw: -1.5, pitch: 0, target: 0 }
        ]
      },
      {
        name: "Scene 3",
        src: "scene3.jpg",
        thumb: "thumb3.jpg",
        hotspots: [
          { yaw: -1, pitch: 0, target: 1 }
        ]
      }
    ];

    let currentScene = 0;
    const viewer = new PhotoSphereViewer.Viewer({
      container: document.getElementById('viewer'),
      panorama: scenes[currentScene].src,
      defaultYaw: '180deg',
      navbar: ['zoom', 'fullscreen'],
      plugins: [PhotoSphereViewer.MarkersPlugin]
    });

    const markersPlugin = viewer.getPlugin(PhotoSphereViewer.MarkersPlugin);

    function loadScene(index) {
      currentScene = index;
      viewer.setPanorama(scenes[index].src).then(() => {
        markersPlugin.clearMarkers();
        scenes[index].hotspots.forEach(hotspot => {
          markersPlugin.addMarker({
            id: `hotspot-${hotspot.target}`,
            longitude: hotspot.yaw,
            latitude: hotspot.pitch,
            image: 'https://cdn-icons-png.flaticon.com/512/60/60525.png',
            width: 32,
            height: 32,
            anchor: 'bottom center',
            tooltip: 'Go here',
            data: { target: hotspot.target }
          });
        });
      });
    }

    markersPlugin.on('select-marker', (e) => {
      if (e.marker.data && e.marker.data.target !== undefined) {
        loadScene(e.marker.data.target);
      }
    });

    function goToNext() {
      currentScene = (currentScene + 1) % scenes.length;
      loadScene(currentScene);
    }

    function goToPrev() {
      currentScene = (currentScene - 1 + scenes.length) % scenes.length;
      loadScene(currentScene);
    }

    const thumbsContainer = document.getElementById('thumbnails');
    scenes.forEach((scene, index) => {
      const img = document.createElement('img');
      img.src = scene.thumb;
      img.className = 'thumb';
      img.alt = scene.name;
      img.onclick = () => loadScene(index);
      thumbsContainer.appendChild(img);
    });

    loadScene(currentScene);
  </script>
</body>
</html>
